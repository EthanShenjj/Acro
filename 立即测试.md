# 🚀 立即测试录制功能

## 我已经为你修复了 CORS 配置！

### 修改内容
- ✅ 更新了 `backend/.env`，添加了 `http://localhost:8000` 到 CORS 白名单
- ✅ 创建了 `start-test.sh` 一键启动脚本
- ✅ 创建了完整的测试指南

## 快速开始（3 步）

### 步骤 1: 启动后端
```bash
# 在终端 1 运行
cd backend
python app.py
```

等待看到：
```
 * Running on http://127.0.0.1:5001
```

### 步骤 2: 启动测试服务器
```bash
# 在终端 2 运行（项目根目录）
./start-test.sh
```

或者手动运行：
```bash
python3 -m http.server 8000
```

### 步骤 3: 开始测试
1. **打开浏览器**
   ```
   http://localhost:8000/test-page.html
   ```

2. **打开控制台**（F12 或 Cmd+Option+I）
   
   应该看到：
   ```
   [Acro] Content script loaded at: ...
   ```
   
   ✅ 如果看到这个，说明扩展已加载！

3. **运行诊断**（可选）
   - 复制 `diagnose-recording.js` 的内容
   - 粘贴到控制台并按回车
   - 应该看到所有检查通过 ✅

4. **开始录制**
   - 点击浏览器工具栏的 Acro 扩展图标
   - 点击 "Start Recording" 按钮
   - **等待 3 秒倒计时完全消失** ⭐ 重要！

5. **测试点击**
   - 点击页面上的按钮
   - 应该看到红色涟漪动画 ✅
   - 控制台应该显示 `[Acro] Processing click event` ✅

6. **测试滚动**
   - 向下滚动页面
   - 应该看到蓝色滚动指示器 ✅
   - 控制台应该显示 `[Acro] Processing scroll event` ✅

7. **检查上传**
   - 打开 Network 标签（F12 → Network）
   - 应该看到 `POST /api/recording/chunk → 200 OK` ✅

8. **停止录制**
   - 点击扩展图标（页面会变灰）
   - 点击 "✅ Done" 按钮
   - 应该自动打开编辑器页面 ✅

9. **验证结果**
   ```bash
   # 在终端运行
   python3 backend/check_projects.py
   ```
   
   应该看到新项目有步骤 ✅

## 重要提示 ⚠️

### 必须做的事情：
1. ✅ 使用 `http://localhost:8000/test-page.html`（不是 `file://`）
2. ✅ 等待 3 秒倒计时完全消失后再操作
3. ✅ 录制时保持在当前标签页，不要切换
4. ✅ 确保后端正在运行

### 不要做的事情：
1. ❌ 不要使用 `file://` 协议打开 test-page.html
2. ❌ 不要在倒计时期间就开始点击
3. ❌ 不要在录制时切换标签页
4. ❌ 不要最小化浏览器窗口

## 成功标志 ✅

如果一切正常，你应该看到：

### 视觉反馈
- ✅ 3 秒倒计时（3、2、1）
- ✅ 点击时的红色涟漪动画
- ✅ 滚动时的蓝色指示器（↓ Scroll Down）
- ✅ 暂停时页面变灰
- ✅ 控制栏显示（▶️ Continue 和 ✅ Done 按钮）

### 控制台日志
```
[Acro] Content script loaded at: ...
[Acro] Received START_CAPTURE message
[Acro] Capture started, event listeners added (click + scroll)
[Acro] Mouse down detected, isRecording: true isPaused: false
[Acro] Processing click event
[Acro] Requesting screenshot from background...
[Acro] Screenshot received, size: 123456
```

### Network 请求
```
POST /api/recording/start → 200 OK
POST /api/recording/chunk → 200 OK (每次操作)
POST /api/recording/stop → 200 OK
```

### 数据库
```
项目 X: New Demo - 2026/02/02 XX:XX - ✅ N 个步骤
  步骤详情:
    1. click - ...
    2. scroll - ...
    3. click - ...
```

## 故障排除

### 问题 1: Content script 未加载
**症状：** 控制台没有 `[Acro] Content script loaded` 日志

**解决方案：**
1. 访问 `chrome://extensions/`
2. 找到 "Acro Demo Recorder"
3. 点击刷新按钮 🔄
4. 刷新测试页面（F5 或 Cmd+R）

### 问题 2: CORS 错误
**症状：** Network 显示 CORS 错误

**解决方案：**
1. 确认后端 `.env` 文件包含 `http://localhost:8000`
2. 重启后端服务
3. 刷新测试页面

### 问题 3: 点击没有涟漪
**症状：** 点击页面没有红色涟漪动画

**解决方案：**
1. 确认等待了 3 秒倒计时
2. 检查控制台是否有 `[Acro] Capture started` 日志
3. 如果没有，重新开始录制

### 问题 4: 后端连接失败
**症状：** Network 显示连接被拒绝

**解决方案：**
```bash
# 测试后端
curl http://localhost:5001/api/folders

# 如果失败，重启后端
cd backend
python app.py
```

## 完整的测试命令

```bash
# 终端 1: 启动后端
cd backend && python app.py

# 终端 2: 启动测试服务器
python3 -m http.server 8000

# 浏览器: 打开测试页面
# http://localhost:8000/test-page.html

# 终端 3: 检查结果（录制完成后）
python3 backend/check_projects.py
```

## 下一步

如果测试成功：
- ✅ 你可以在任何网页上使用录制功能
- ✅ 可以在 Dashboard 中管理录制的项目
- ✅ 可以编辑步骤和导出视频

如果测试失败：
- 📋 查看 `快速测试指南.md` 获取详细说明
- 📋 查看 `录制问题诊断结果.md` 了解常见问题
- 📋 运行 `diagnose-recording.js` 进行自动诊断

## 需要帮助？

如果仍然有问题，请提供：
1. 控制台完整日志（包含所有 [Acro] 日志）
2. Network 标签截图
3. 后端终端日志
4. `python3 backend/check_projects.py` 的输出

祝测试顺利！🎉
