<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯• Null é”™è¯¯ä¿®å¤</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      line-height: 1.6;
    }
    
    .test-section {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .test-button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    
    .test-button:hover {
      background: #0b7dda;
    }
    
    .status {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .log-container {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
    }
    
    .log-entry {
      margin: 5px 0;
      padding: 2px 0;
    }
    
    .log-entry.error {
      color: #f48771;
    }
    
    .log-entry.success {
      color: #89d185;
    }
    
    .log-entry.info {
      color: #6cb6ff;
    }
    
    h1 {
      color: #333;
    }
    
    h2 {
      color: #555;
      margin-top: 30px;
    }
    
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ Acro æ‰©å±• - Null é”™è¯¯ä¿®å¤æµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯• "Cannot read properties of null (reading '2')" é”™è¯¯çš„ä¿®å¤ã€‚</p>
    <ol>
      <li>ç¡®ä¿å·²é‡æ–°åŠ è½½ Acro æ‰©å±•ï¼ˆåœ¨ <code>chrome://extensions/</code> ä¸­ç‚¹å‡»åˆ·æ–°ï¼‰</li>
      <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰</li>
      <li>åˆ‡æ¢åˆ° Console æ ‡ç­¾</li>
      <li>ç‚¹å‡»æ‰©å±•å›¾æ ‡å¼€å§‹å½•åˆ¶</li>
      <li>ç‚¹å‡»ä¸‹é¢çš„æµ‹è¯•æŒ‰é’®</li>
      <li>è§‚å¯Ÿæ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯</li>
    </ol>
  </div>
  
  <div class="test-section">
    <h2>ğŸ¯ æµ‹è¯•æ“ä½œ</h2>
    <button class="test-button" onclick="testClick(1)">æµ‹è¯•ç‚¹å‡» 1</button>
    <button class="test-button" onclick="testClick(2)">æµ‹è¯•ç‚¹å‡» 2</button>
    <button class="test-button" onclick="testClick(3)">æµ‹è¯•ç‚¹å‡» 3</button>
    <button class="test-button" onclick="testScroll()">æµ‹è¯•æ»šåŠ¨</button>
    <button class="test-button" onclick="checkExtension()">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
    <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
  </div>
  
  <div class="test-section">
    <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
    <div id="status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    <div id="logs" class="log-container"></div>
  </div>
  
  <div class="test-section">
    <h2>âœ… é¢„æœŸè¡Œä¸º</h2>
    <ul>
      <li>ç‚¹å‡»æŒ‰é’®æ—¶åº”è¯¥çœ‹åˆ°çº¢è‰²çš„ç‚¹å‡»æ³¢çº¹åŠ¨ç”»</li>
      <li>æ§åˆ¶å°åº”è¯¥æ˜¾ç¤º <code>[Acro]</code> å¼€å¤´çš„æ—¥å¿—æ¶ˆæ¯</li>
      <li><strong>ä¸åº”è¯¥</strong>çœ‹åˆ°ä»»ä½• "Cannot read properties of null" é”™è¯¯</li>
      <li>å¦‚æœå‡ºç°é”™è¯¯ï¼Œåº”è¯¥æœ‰è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œä¸Šä¸‹æ–‡</li>
    </ul>
  </div>
  
  <div class="test-section">
    <h2>ğŸ› å¦‚æœä»æœ‰é”™è¯¯</h2>
    <p>è¯·åœ¨æ§åˆ¶å°ä¸­æŸ¥æ‰¾ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
    <ul>
      <li><code>[Acro] Chrome runtime available: true/false</code></li>
      <li><code>[Acro] Invalid session state response</code></li>
      <li><code>[Acro] Screenshot request error</code></li>
      <li>å®Œæ•´çš„é”™è¯¯å †æ ˆè·Ÿè¸ª</li>
    </ul>
    <p>å°†è¿™äº›ä¿¡æ¯æä¾›ç»™å¼€å‘è€…ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­ã€‚</p>
  </div>
  
  <!-- æ·»åŠ ä¸€äº›å†…å®¹ä»¥ä¾¿æµ‹è¯•æ»šåŠ¨ -->
  <div style="height: 1000px; background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); padding: 20px; margin-top: 20px; border-radius: 8px;">
    <h3>æ»šåŠ¨æµ‹è¯•åŒºåŸŸ</h3>
    <p>å‘ä¸‹æ»šåŠ¨ä»¥æµ‹è¯•æ»šåŠ¨æ•è·åŠŸèƒ½...</p>
    <div style="margin-top: 800px;">
      <p>âœ¨ ä½ å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨äº†ï¼</p>
    </div>
  </div>
  
  <script>
    let clickCount = 0;
    let testLogs = [];
    
    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      testLogs.push({ message: logEntry, type });
      
      const logsContainer = document.getElementById('logs');
      const logElement = document.createElement('div');
      logElement.className = `log-entry ${type}`;
      logElement.textContent = logEntry;
      logsContainer.appendChild(logElement);
      logsContainer.scrollTop = logsContainer.scrollHeight;
      
      console.log(`[Test Page] ${message}`);
    }
    
    function updateStatus(message, type = 'info') {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;
    }
    
    function testClick(num) {
      clickCount++;
      addLog(`æµ‹è¯•ç‚¹å‡» ${num} - æ€»ç‚¹å‡»æ¬¡æ•°: ${clickCount}`, 'info');
      updateStatus(`å·²ç‚¹å‡» ${clickCount} æ¬¡`, 'success');
    }
    
    function testScroll() {
      addLog('å¼€å§‹æ»šåŠ¨æµ‹è¯•...', 'info');
      window.scrollTo({
        top: document.body.scrollHeight / 2,
        behavior: 'smooth'
      });
      setTimeout(() => {
        addLog('æ»šåŠ¨å®Œæˆ', 'success');
      }, 1000);
    }
    
    function checkExtension() {
      addLog('æ£€æŸ¥æ‰©å±•çŠ¶æ€...', 'info');
      
      // Check if Chrome extension API is available
      if (typeof chrome === 'undefined' || !chrome.runtime) {
        addLog('âŒ Chrome æ‰©å±• API ä¸å¯ç”¨', 'error');
        updateStatus('Chrome æ‰©å±• API ä¸å¯ç”¨', 'error');
        return;
      }
      
      addLog('âœ… Chrome æ‰©å±• API å¯ç”¨', 'success');
      
      // Try to get session state
      try {
        chrome.runtime.sendMessage({ type: 'GET_SESSION_STATE' }, (response) => {
          if (chrome.runtime.lastError) {
            addLog(`âŒ é€šä¿¡é”™è¯¯: ${chrome.runtime.lastError.message}`, 'error');
            updateStatus('æ‰©å±•é€šä¿¡å¤±è´¥', 'error');
            return;
          }
          
          if (response && response.session) {
            addLog(`âœ… ä¼šè¯çŠ¶æ€: ${response.session.status}`, 'success');
            addLog(`   Session ID: ${response.session.sessionId || 'null'}`, 'info');
            addLog(`   Step Count: ${response.session.stepCount}`, 'info');
            updateStatus(`æ‰©å±•æ­£å¸¸ - çŠ¶æ€: ${response.session.status}`, 'success');
          } else {
            addLog('âŒ æ— æ•ˆçš„å“åº”æ ¼å¼', 'error');
            updateStatus('æ‰©å±•å“åº”å¼‚å¸¸', 'error');
          }
        });
      } catch (error) {
        addLog(`âŒ å¼‚å¸¸: ${error.message}`, 'error');
        updateStatus('æ£€æŸ¥å¤±è´¥', 'error');
      }
    }
    
    function clearLogs() {
      testLogs = [];
      document.getElementById('logs').innerHTML = '';
      addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
    }
    
    // Monitor console errors
    window.addEventListener('error', (event) => {
      addLog(`âŒ é¡µé¢é”™è¯¯: ${event.message}`, 'error');
      updateStatus('æ£€æµ‹åˆ°é”™è¯¯ - æŸ¥çœ‹æ—¥å¿—', 'error');
    });
    
    // Monitor unhandled promise rejections
    window.addEventListener('unhandledrejection', (event) => {
      addLog(`âŒ Promise é”™è¯¯: ${event.reason}`, 'error');
      updateStatus('æ£€æµ‹åˆ° Promise é”™è¯¯ - æŸ¥çœ‹æ—¥å¿—', 'error');
    });
    
    // Initial log
    addLog('æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
    addLog('ç­‰å¾…å¼€å§‹å½•åˆ¶...', 'info');
    
    // Check extension on load
    setTimeout(checkExtension, 1000);
  </script>
</body>
</html>
