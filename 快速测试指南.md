# 快速测试指南

## 问题说明

你遇到的问题是：
1. ❌ Content script 未加载到 `file://` 协议的页面
2. ❌ CORS 阻止了从 `file://` 访问 `http://localhost:5001`

## 解决方案：使用 HTTP 服务器

### 方法 1: 使用 Python 简单服务器（推荐）

```bash
# 在项目根目录运行
python3 -m http.server 8000
```

然后在浏览器打开：
```
http://localhost:8000/test-page.html
```

### 方法 2: 使用 Node.js http-server

```bash
# 安装（如果没有）
npm install -g http-server

# 运行
http-server -p 8000
```

然后在浏览器打开：
```
http://localhost:8000/test-page.html
```

### 方法 3: 直接测试真实网页

在浏览器中打开任意网页，例如：
```
https://example.com
https://www.google.com
http://localhost:3000  (如果 dashboard 在运行)
```

## 完整测试流程

### 步骤 1: 启动后端
```bash
# 终端 1
cd backend
python app.py
```

确保看到：
```
 * Running on http://127.0.0.1:5001
```

### 步骤 2: 启动测试服务器
```bash
# 终端 2（在项目根目录）
python3 -m http.server 8000
```

确保看到：
```
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

### 步骤 3: 检查扩展
1. 打开 `chrome://extensions/`
2. 找到 "Acro Demo Recorder"
3. 确认已启用（开关是蓝色）
4. 点击刷新按钮 🔄

### 步骤 4: 打开测试页面
在浏览器中访问：
```
http://localhost:8000/test-page.html
```

**重要：** 必须是 `http://` 开头，不是 `file://`

### 步骤 5: 打开控制台
按 `F12` 或 `Cmd+Option+I`

应该看到：
```
[Acro] Content script loaded at: 2026-02-02T...
[Acro] Initial state - isRecording: false isPaused: false
```

如果看到这个，说明 content script 已加载！✅

### 步骤 6: 运行诊断脚本
在控制台粘贴并运行 `diagnose-recording.js` 的内容

应该看到：
```
✅ Content script 已加载
✅ 会话状态正常
✅ 后端连接正常
```

### 步骤 7: 开始录制
1. 点击浏览器工具栏的 Acro 扩展图标
2. 点击 "Start Recording" 按钮
3. **等待 3 秒倒计时完全消失** ⭐

控制台应该显示：
```
[Acro] Content script received message: SHOW_COUNTDOWN
[Acro] Showing countdown for 3 seconds
[Acro] Countdown completed
[Acro] Content script received message: START_CAPTURE
[Acro] Received START_CAPTURE message
[Acro] Starting capture, isRecording: false isPaused: false
[Acro] Capture started, event listeners added (click + scroll)
```

### 步骤 8: 测试点击
点击页面上的按钮

应该看到：
- ✅ 红色涟漪动画
- ✅ 控制台日志：`[Acro] Mouse down detected, isRecording: true isPaused: false`
- ✅ 控制台日志：`[Acro] Processing click event`
- ✅ 控制台日志：`[Acro] Screenshot received, size: ...`

### 步骤 9: 测试滚动
向下滚动页面

应该看到：
- ✅ 蓝色滚动指示器（↓ Scroll Down）
- ✅ 控制台日志：`[Acro] Scroll detected`
- ✅ 控制台日志：`[Acro] Processing scroll event`

### 步骤 10: 检查上传
打开 Network 标签（F12 → Network）

应该看到：
```
POST http://localhost:5001/api/recording/chunk → 200 OK
```

每次点击或滚动都应该有一个请求。

### 步骤 11: 停止录制
1. 点击扩展图标（页面会变灰）
2. 点击 "✅ Done" 按钮
3. 应该自动打开编辑器页面

### 步骤 12: 检查结果
在编辑器页面应该看到：
- ✅ 录制的步骤列表
- ✅ 每个步骤的截图
- ✅ 步骤数量正确

### 步骤 13: 验证数据库
```bash
# 在终端运行
python3 backend/check_projects.py
```

应该看到：
```
项目 X: New Demo - 2026/02/02 XX:XX - ✅ N 个步骤
```

## 常见问题

### Q: 为什么 file:// 不行？
**A:** Chrome 扩展对 `file://` 协议有限制：
- Content scripts 默认不注入到 file:// 页面
- CORS 策略阻止 file:// 访问 http://
- 需要额外的权限配置

### Q: 我不想启动服务器，有其他方法吗？
**A:** 可以直接在真实网页上测试：
1. 打开 https://example.com
2. 按照上述步骤开始录制
3. 点击页面上的链接或按钮

### Q: 如何启用 file:// 支持？
**A:** 在 `chrome://extensions/` 页面：
1. 找到 "Acro Demo Recorder"
2. 点击 "详细信息"
3. 启用 "允许访问文件网址"
4. 刷新 test-page.html

但即使这样，CORS 问题仍然存在。

## 推荐的测试环境

### 最简单：使用 Python 服务器
```bash
# 终端 1: 后端
cd backend && python app.py

# 终端 2: 测试服务器
python3 -m http.server 8000

# 浏览器
http://localhost:8000/test-page.html
```

### 最真实：使用 Dashboard
```bash
# 终端 1: 后端
cd backend && python app.py

# 终端 2: 前端
cd dashboard && npm run dev

# 浏览器
http://localhost:3000
```

在 Dashboard 中点击 "New Recording" 按钮开始录制。

## 成功标志

如果一切正常，你应该看到：

✅ 控制台有 `[Acro] Content script loaded`  
✅ 诊断脚本显示所有检查通过  
✅ 倒计时显示（3、2、1）  
✅ 点击有红色涟漪动画  
✅ 滚动有蓝色指示器  
✅ Network 有成功的 chunk 请求  
✅ 停止后打开编辑器  
✅ 编辑器显示录制的步骤  
✅ 数据库有新项目和步骤  

## 下一步

1. **立即测试**
   ```bash
   # 启动服务器
   python3 -m http.server 8000
   
   # 打开浏览器
   http://localhost:8000/test-page.html
   ```

2. **运行诊断**
   - 在控制台运行 diagnose-recording.js
   - 确认所有检查通过

3. **开始录制**
   - 严格按照上述步骤操作
   - 特别注意：等待倒计时 + 不要切换标签

4. **检查结果**
   ```bash
   python3 backend/check_projects.py
   ```

如果仍然有问题，请提供：
- 控制台完整日志
- Network 标签截图
- 后端日志
- 数据库检查结果
