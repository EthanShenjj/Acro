# åœæ­¢å½•åˆ¶é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°
ç‚¹å‡»åœæ­¢å½•åˆ¶åæ²¡æœ‰ååº”ï¼Œè¿‡ä¸€ä¼šå„¿æ‰å¼¹å‡ºè§†é¢‘é¢„è§ˆé¡µï¼Œä½†æ˜¯æ˜¾ç¤ºæ²¡æœ‰äº‹ä»¶ã€‚

## å·²åº”ç”¨çš„ä¿®å¤

æˆ‘å·²ç»å¯¹ä»£ç è¿›è¡Œäº†ä»¥ä¸‹ä¿®å¤ï¼š

### 1. å¢åŠ ä¸Šä¼ é˜Ÿåˆ—åˆ·æ–°è¶…æ—¶æ—¶é—´
- **ä¿®æ”¹**: ä» 2 ç§’å¢åŠ åˆ° 10 ç§’
- **åŸå› **: ç»™ä¸Šä¼ æ›´å¤šæ—¶é—´å®Œæˆ
- **ä½ç½®**: `extension/background.js` çš„ `flushUploadQueue()` å‡½æ•°

### 2. å‡å°‘æ‰¹é‡ä¸Šä¼ ç­‰å¾…æ—¶é—´
- **ä¿®æ”¹**: ä» 10 ç§’å‡å°‘åˆ° 2 ç§’
- **åŸå› **: æ›´å¿«åœ°è§¦å‘æ‰¹é‡ä¸Šä¼ ï¼Œä¸ç”¨ç­‰å¤ªä¹…
- **ä½ç½®**: `extension/background.js` çš„ `BATCH_TIMEOUT_MS` å¸¸é‡

### 3. å‡å°‘ START_CAPTURE å»¶è¿Ÿ
- **ä¿®æ”¹**: ä» 3.5 ç§’å‡å°‘åˆ° 3.1 ç§’
- **åŸå› **: å€’è®¡æ—¶ 3 ç§’åç«‹å³å¼€å§‹æ•è·
- **ä½ç½®**: `extension/background.js` çš„ `handleStartRecording()` å‡½æ•°

### 4. æ·»åŠ è°ƒè¯•æ—¥å¿—
- **ä¿®æ”¹**: åœ¨åœæ­¢å½•åˆ¶æ—¶è¾“å‡ºé˜Ÿåˆ—çŠ¶æ€
- **åŸå› **: æ–¹ä¾¿è¯Šæ–­é—®é¢˜
- **ä½ç½®**: `extension/background.js` çš„ `handleStopRecording()` å‡½æ•°

## æµ‹è¯•æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé‡æ–°åŠ è½½æ‰©å±•

1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. æ‰¾åˆ° "Acro Demo Recorder" æ‰©å±•
4. ç‚¹å‡»"é‡æ–°åŠ è½½"æŒ‰é’®ï¼ˆğŸ”„ï¼‰

### ç¬¬äºŒæ­¥ï¼šæ‰“å¼€æµ‹è¯•é¡µé¢

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `test-stop-recording.html` æ–‡ä»¶
2. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (æŒ‰ F12 æˆ–å³é”® -> æ£€æŸ¥)
3. åˆ‡æ¢åˆ° Console æ ‡ç­¾

### ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹å½•åˆ¶

1. ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ‰©å±•å›¾æ ‡
2. ç‚¹å‡»"Start Recording"æŒ‰é’®
3. ç­‰å¾… 3 ç§’å€’è®¡æ—¶å®Œæˆ
4. è§‚å¯Ÿæ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   [Acro] Content script loaded at: ...
   [Acro] Showing countdown for 3 seconds
   [Acro] Countdown completed
   [Background] Sending START_CAPTURE to tab ...
   [Acro] Received START_CAPTURE message
   [Acro] Starting capture, isRecording: false isPaused: false
   [Acro] Capture started, event listeners added (click + scroll)
   ```

### ç¬¬å››æ­¥ï¼šæ‰§è¡Œæµ‹è¯•æ“ä½œ

1. **ç‚¹å‡»æµ‹è¯•**: ç‚¹å‡» 2-3 ä¸ªå½©è‰²æŒ‰é’®
   - æ¯æ¬¡ç‚¹å‡»åï¼Œè§‚å¯Ÿæ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š
     ```
     [Acro] Mouse down detected, isRecording: true isPaused: false
     [Acro] Processing click event
     [Acro] Screenshot validated, size: ...
     [Acro] Uploading step with validated data
     [Background] Upload successful: ...
     ```

2. **æ»šåŠ¨æµ‹è¯•**: å‘ä¸‹æ»šåŠ¨é¡µé¢
   - æ»šåŠ¨åï¼Œè§‚å¯Ÿæ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š
     ```
     [Acro] Scroll detected, isRecording: true isPaused: false
     [Acro] Processing scroll event, delta: ...
     [Acro] Screenshot validated, size: ...
     [Acro] Uploading scroll step with validated data
     [Background] Upload successful: ...
     ```

3. **ç­‰å¾…ä¸Šä¼ **: åœæ­¢æ“ä½œï¼Œç­‰å¾… 2-3 ç§’
   - è®©æ‰¹é‡ä¸Šä¼ æœ‰æ—¶é—´å®Œæˆ

### ç¬¬äº”æ­¥ï¼šåœæ­¢å½•åˆ¶

1. ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ‰©å±•å›¾æ ‡
2. ç‚¹å‡»"Stop Recording"æŒ‰é’®
3. è§‚å¯Ÿæ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   [Background] Starting stop recording process...
   [Background] Current session: {...}
   [Background] Upload queue length: 0
   [Background] Active upload promise: false
   [Background] Flushing upload queue...
   [Background] Calling /api/recording/stop with sessionId: ...
   [Background] Stop recording response status: 200
   [Background] Stop recording result: {...}
   [Background] Opening editor in new tab: ...
   [Background] New tab created: ...
   [Background] State reset to idle
   [Background] Stop recording completed successfully
   ```

4. æµè§ˆå™¨åº”è¯¥è‡ªåŠ¨æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œæ˜¾ç¤ºç¼–è¾‘å™¨ç•Œé¢

### ç¬¬å…­æ­¥ï¼šéªŒè¯ç»“æœ

åœ¨ç¼–è¾‘å™¨é¡µé¢ä¸­ï¼Œæ£€æŸ¥ï¼š

1. âœ… é¡¹ç›®æ ‡é¢˜æ˜¾ç¤ºæ­£ç¡®ï¼ˆä¾‹å¦‚ï¼š"New Demo - 2026/02/02 23:30"ï¼‰
2. âœ… å·¦ä¾§æ­¥éª¤åˆ—è¡¨æ˜¾ç¤ºäº†ä½ å½•åˆ¶çš„æ­¥éª¤
3. âœ… æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æˆªå›¾
4. âœ… ç‚¹å‡»æ­¥éª¤å¯ä»¥æŸ¥çœ‹è¯¦æƒ…
5. âœ… å¯ä»¥æ’­æ”¾è§†é¢‘é¢„è§ˆ

## å¦‚æœä»ç„¶æœ‰é—®é¢˜

### è¿è¡Œè¯Šæ–­è„šæœ¬

1. åœ¨å½•åˆ¶è¿‡ç¨‹ä¸­æˆ–å½•åˆ¶åï¼Œæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. å¤åˆ¶ `extension/diagnose-stop-issue.js` çš„å†…å®¹
3. ç²˜è´´åˆ°æ§åˆ¶å°å¹¶æŒ‰å›è½¦
4. æŸ¥çœ‹è¯Šæ–­ç»“æœ

è¯Šæ–­è„šæœ¬ä¼šæ£€æŸ¥ï¼š
- æ‰©å±• API æ˜¯å¦å¯ç”¨
- ä¼šè¯çŠ¶æ€
- æ­¥éª¤è®¡æ•°
- åç«¯æ•°æ®
- IndexedDB ä¸­çš„å¤±è´¥ä¸Šä¼ 
- æˆªå›¾åŠŸèƒ½

### æ£€æŸ¥å¸¸è§é—®é¢˜

#### é—®é¢˜ 1: æ§åˆ¶å°æ˜¾ç¤º "Upload queue length: 5"

**åŸå› **: æœ‰äº‹ä»¶åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸Šä¼ 

**è§£å†³**:
- ç­‰å¾…æ›´é•¿æ—¶é—´ï¼ˆ10 ç§’ï¼‰
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ

#### é—®é¢˜ 2: æ§åˆ¶å°æ˜¾ç¤º "Screenshot capture failed"

**åŸå› **: æˆªå›¾å¤±è´¥

**è§£å†³**:
- ç¡®ä¿å½•åˆ¶æ ‡ç­¾é¡µæ˜¯æ´»åŠ¨æ ‡ç­¾é¡µ
- ä¸è¦åœ¨å½•åˆ¶æœŸé—´åˆ‡æ¢æ ‡ç­¾é¡µ
- åˆ·æ–°é¡µé¢åé‡æ–°å½•åˆ¶

#### é—®é¢˜ 3: æ§åˆ¶å°æ˜¾ç¤º "Invalid session ID"

**åŸå› **: ä¼šè¯å·²è¿‡æœŸæˆ–æ— æ•ˆ

**è§£å†³**:
- é‡æ–°å¼€å§‹å½•åˆ¶
- æ£€æŸ¥åç«¯æ—¥å¿—

#### é—®é¢˜ 4: ç¼–è¾‘å™¨æ˜¾ç¤º "No steps found"

**åŸå› **: æ­¥éª¤æ²¡æœ‰ä¿å­˜åˆ°æ•°æ®åº“

**è§£å†³**:
- æ£€æŸ¥åç«¯æ—¥å¿—
- è¿è¡Œè¯Šæ–­è„šæœ¬æŸ¥çœ‹è¯¦æƒ…
- æ£€æŸ¥æ•°æ®åº“è¿æ¥

### æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
# åœ¨ backend ç›®å½•ä¸‹
cd backend

# æŸ¥çœ‹ Flask æ—¥å¿—
# æ—¥å¿—åº”è¯¥æ˜¾ç¤ºåœ¨è¿è¡Œ Flask çš„ç»ˆç«¯ä¸­

# æˆ–è€…æ£€æŸ¥æ•°æ®åº“
python3 -c "
from app import app, db
from models.project import Project
from models.step import Step

with app.app_context():
    projects = Project.query.all()
    print(f'Total projects: {len(projects)}')
    for p in projects:
        steps = Step.query.filter_by(project_id=p.id).all()
        print(f'Project {p.id}: {p.title} - {len(steps)} steps')
"
```

### æ‰‹åŠ¨æ£€æŸ¥æ•°æ®åº“

```bash
# è¿æ¥åˆ°æ•°æ®åº“
sqlite3 backend/acro.db

# æŸ¥çœ‹é¡¹ç›®
SELECT id, title, created_at FROM projects ORDER BY created_at DESC LIMIT 5;

# æŸ¥çœ‹æœ€æ–°é¡¹ç›®çš„æ­¥éª¤
SELECT id, order_index, action_type, target_text FROM steps 
WHERE project_id = (SELECT id FROM projects ORDER BY created_at DESC LIMIT 1);

# é€€å‡º
.quit
```

## é¢„é˜²æªæ–½

ä¸ºäº†é¿å…å°†æ¥å‡ºç°ç±»ä¼¼é—®é¢˜ï¼š

1. **å½•åˆ¶æœŸé—´ä¿æŒæ ‡ç­¾é¡µæ´»åŠ¨**
   - ä¸è¦åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µ
   - ä¸è¦æœ€å°åŒ–æµè§ˆå™¨çª—å£

2. **ç­‰å¾…ä¸Šä¼ å®Œæˆ**
   - æ‰§è¡Œæ“ä½œåç­‰å¾… 2-3 ç§’
   - è§‚å¯Ÿæ§åˆ¶å°ç¡®è®¤ä¸Šä¼ æˆåŠŸ

3. **ä½¿ç”¨ç®€å•çš„æµ‹è¯•é¡µé¢**
   - é¿å…å¤æ‚çš„å•é¡µåº”ç”¨
   - é¿å…æœ‰å¤§é‡åŠ¨ç”»çš„é¡µé¢

4. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   - ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

5. **å®šæœŸæ¸…ç†æ•°æ®**
   - åˆ é™¤æ—§çš„æµ‹è¯•é¡¹ç›®
   - æ¸…ç† IndexedDB ä¸­çš„å¤±è´¥ä¸Šä¼ 

## è·å–å¸®åŠ©

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´æ—¥å¿—
2. è¯Šæ–­è„šæœ¬çš„è¾“å‡º
3. åç«¯æ—¥å¿—
4. æ•°æ®åº“æŸ¥è¯¢ç»“æœ
5. é‡ç°é—®é¢˜çš„è¯¦ç»†æ­¥éª¤

## æ€»ç»“

ä¿®å¤å·²åº”ç”¨ï¼Œä¸»è¦æ”¹è¿›ï¼š
- âœ… å¢åŠ ä¸Šä¼ é˜Ÿåˆ—åˆ·æ–°è¶…æ—¶æ—¶é—´ï¼ˆ2ç§’ â†’ 10ç§’ï¼‰
- âœ… å‡å°‘æ‰¹é‡ä¸Šä¼ ç­‰å¾…æ—¶é—´ï¼ˆ10ç§’ â†’ 2ç§’ï¼‰
- âœ… å‡å°‘ START_CAPTURE å»¶è¿Ÿï¼ˆ3.5ç§’ â†’ 3.1ç§’ï¼‰
- âœ… æ·»åŠ æ›´å¤šè°ƒè¯•æ—¥å¿—

è¯·æŒ‰ç…§ä¸Šè¿°æµ‹è¯•æ­¥éª¤éªŒè¯ä¿®å¤æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œä½¿ç”¨è¯Šæ–­è„šæœ¬è¿›ä¸€æ­¥æ’æŸ¥ã€‚
